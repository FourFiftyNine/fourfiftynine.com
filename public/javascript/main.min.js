(function(e,t,n){"use strict";var r=e.CDLIX||{},i=e.history,s=e.location,o=e.Modernizr,u=t(e),a=t(document),f=r.main={init:function(){f.$content=t("#content"),f.$article=t("#content > article"),f.$spinner=t("#spinner"),f.titleHistory={},f.titleHistory[s.pathname]=document.title,f.togglingContent=!1,f.$activeContent=f.setActiveContent(),f.initSlider(),f.fadeInContent(),~s.pathname.indexOf("contact")&&f.onClickContactFormNavigation(),u.resize(function(){f.setCopyCSSPosition()}),t.validator.addMethod("phoneUS",function(e,t){return e=e.replace(/\s+/g,""),this.optional(t)||e.length>9&&e.match(/^(1-?)?(\([2-9]\d{2}\)|[2-9]\d{2})-?[2-9]\d{2}-?\d{4}$/)},"Please specify a valid phone number"),t.validator.setDefaults({rules:{name:"required",email:{required:!0,email:!0},message:"required",tel:{required:!0,phoneUS:!0},date:{required:!0,date:!0}},messages:{name:"Please specify your name",email:{required:"Please specify your email",email:"Please enter a valid email"},message:"Please enter a message",tel:{required:"Please enter a phone number",phoneUS:"Please enter a phone number"},date:{required:"Enter a date",date:"Invalid date (M/D/Y)"}},submitHandler:function(n){var r={dataType:"json",beforeSubmit:function(n,r,i){t("#contact-info").append(f.$spinner),f.toggleSpinner(),e.document.activeElement.blur()},success:function(e){!e.errors||(t("#success-message").text(e.success),f.$spinner.animate({opacity:0},"fast",function(){f.toggleSpinner(),f.$content.append(f.$spinner),t("#success-message").animate({opacity:1},"fast"),t(n).resetForm()}))}};t(n).ajaxSubmit(r)}}),f.onContactFormSubmit(),o.history&&(e.addEventListener("popstate",f.getContent),t("body").on("click","a.pushstate",function(e){var n=t(this).attr("href");f.getContent(e,n),i.pushState(null,null,n),e.preventDefault()}))},setActiveContent:function(){return t("#projects").length?(t("#projects").addClass("active-content").find("article").addClass("active-content"),t("#projects")):t("#content > section").addClass("active-content")},getContent:function(e,n){if(f.togglingContent)return!1;n=n||s.pathname;var r=n.split("/");r.shift();var i,o;r.length>1&&r[0]==="projects"?(i=r[0],o=r[1]):r[0]==="projects"?i="projects-list":r[0]===""?i="home":i=r[0];var u=t("#"+o),a=t("#"+i);u.length?f.toggleContent(i,o):o?f.ajaxLoadContent(n,i,o):a.length?f.toggleContent(i):f.ajaxLoadContent(n,i),f.titleHistory[n]&&(document.title=f.titleHistory[n])},ajaxLoadContent:function(n,r,i){t.ajax({url:n,method:"post",dataType:"HTML",data:{},success:function(s){t("#projects").length&&i?t(s).find("#"+i).appendTo("#projects"):t(s).find("#"+r).appendTo("#content"),f.titleHistory[n]||(f.titleHistory[n]=t(s).filter("title").text()),document.title=f.titleHistory[n],f.toggleContent(r,i),typeof e.pageTracker!="undefined"&&e.pageTracker._trackPageview(n)}})},ajaxLoadContentSuccess:function(e,t,n){},toggleContent:function(e,n){var r=t("#"+e),i=t("#"+n);f.togglingContent=!0,e=="contact"&&(f.contactFormBound||f.onClickContactFormNavigation(),f.onContactFormSubmit()),!r.hasClass("active-content")&&!i.hasClass("active-content")?n?(!t("#projects").length||!t("#projects").hasClass("active-content"))&&f.$activeContent.fadeOut(500,function(){i.show().addClass("active-content"),f.fadeInAndSetActiveContent(r)}):f.$activeContent.fadeOut(500,function(){f.fadeInAndSetActiveContent(r)}):r.hasClass("active-content")&&!i.hasClass("active-content")?(f.$activeContent.find("article.active-content").fadeOut(500,function(){f.setPrevNextControls(i),t(this).removeClass("active-content"),i.fadeIn(500,function(){t(this).addClass("active-content"),f.togglingContent=!1})}),f.togglingContent=!1):f.togglingContent=!1},fadeInAndSetActiveContent:function(e){f.$activeContent.removeClass("active-content").children(".active-content").hide().removeClass("active-content"),e.fadeIn(500,function(){t(this).attr("id")=="home"&&f.initSlider(),f.$activeContent=t(this).addClass("active-content"),f.togglingContent=!1,f.setCopyCSSPosition()})},setPrevNextControls:function(e){var n=e.find(".controls"),r="/projects/",i=n.attr("data-prev"),s=n.attr("data-next");i?t("#prev").attr("href",r+i).removeClass("hidden"):t("#prev").addClass("hidden"),s?t("#next").attr("href",r+s).removeClass("hidden"):t("#next").addClass("hidden")},setCopyCSSPosition:function(){var e=u.height(),n="fixed",r="static",i=t("#projects article.active-content .copy");i.height()>e?i.css({position:r,width:"40%"}):i.css({position:n,width:"35%"})},onContactFormSubmit:function(){t("#project-message, #send-message").each(function(){t(this).validate()})},onClickContactFormNavigation:function(){var e=t("#contact-form-navigation"),n=e.find("a"),r=e.siblings("header").find("h1");f.contactFormBound=!0,n.click(function(e){var i=t(this),s=t(this).attr("href"),o=t(this).attr("title");n.removeClass("active"),i.addClass("active"),t(".contact-form.active").animate({opacity:0},500,function(){t(this).removeClass("active"),t(s+"-message").css("opacity",0).addClass("active").animate({opacity:1},500,function(){}),r.text(o)}),e.preventDefault()})},fadeInContent:function(){t("html").hasClass("lt-ie9")||f.$content.delay(400).fadeIn(500,function(){f.setCopyCSSPosition()})},toggleSpinner:function(){if(f.spinner)f.spinner.stop();else{var e={lines:13,length:22,width:7,radius:21,rotate:0,color:"#505050",speed:1.4,trail:73,shadow:!0,hwaccel:!0,className:"spinner",zIndex:2e9,top:"auto",left:"auto"},t=document.getElementById("spinner");f.spinner=(new Spinner(e)).spin(t),f.$spinner.animate({opacity:1},500)}},initSlider:function(){t("#slideshow").cycle({slideExpr:".slide",slideResize:0,containerResize:0,fit:1,pager:"#slideshow-nav"})}};a.ready(f.init)})(window,jQuery);